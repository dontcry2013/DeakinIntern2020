<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
  <script lang="javascript" src="dist/xlsx.full.min.js"></script>
  <title>Document</title>
</head>
<body>
  
  <div id="app">
    <input id="file" type="file" @change="parseExcelFile1" />
  </div>
</body>
</html>

<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>



<script type="text/babel">
  var app = new Vue({
    el: '#app',
   
    methods: {
      parseExcelFile1: function () {
        var vm = this;

        var files = event.target.files || [];
        if (!files.length) return;
        var file = files[0];
        
        var result={};
        var session ="";
        var weekday=""
        var detail = ""
        var type = 0
        var data = []
        console.time();
        var reader = new FileReader();
        reader.onloadend = function (event) {
          var arrayBuffer = reader.result;
          var options = { type: 'array' };
          // var options = { type: 'buffer' };
          var workbook = XLSX.read(arrayBuffer, options);
          var sheetName;
          if(Array.isArray(workbook.SheetNames)){
            sheetName = workbook.SheetNames[0];
          } else{
            sheetName = workbook.SheetNames;
          }
          var sheet = workbook.Sheets[sheetName];
          // console.log(sheet)
          vm.rawData = XLSX.utils.sheet_to_json(sheet, {header:1}); 
          var week = vm.rawData[1]  //遍历整个表格形成数组
          vm.rawData.some(function(value,index)//遍历形成的所有数组
         {
            var k_value = value;
            if(index == 0){ //当遍历到第一个数组的时候（获取表格的基本信息，包括年级，专业等）
                var string = k_value[0].toString();
                var str = ' ';
                var StringArray =(string.split(str)); //以str中的内容为标志隔开字符串
                result['cohort'] = StringArray[42];
                result['term'] = StringArray[0];
                result['major'] = StringArray[74];
            }
            if(index>=2 && index <=7){ //当遍历到第三个到第七个数组（获取课程）
                for(var i =0; i <= 6; i++){
                    var classes = k_value[i];
                    if(classes != null){
                    var string2 = classes.toString();//当有课程的时候存入变量中
                    if(string2.indexOf("英语") != -1){//判断当前课程是否为英语课
                        var classes2 = (classes.split("\r"))//以“”中的内容为标志隔开字符串（因为有些英语课下面还有其他课程，用这个方法与其他课程区分开）
                        detail = classes2[0];
                        weekday = week[i]//课程对应的星期
                        session = k_value[1];//课程对应的时间（该信息是k_value的在第二个数组中）
                        //英语课分类
                        if(string2.indexOf("综合") != -1){
                            type = 1
                        }
                        else if(string2.indexOf("口语") != -1)
                 {
                   type = 2
                 }
                 else if(string2.indexOf("workshop") != -1)
                 {
                  type = 3
                 }
                var obj ={ //声明结构，并且赋值
                    weekday: weekday,
                    session: session,
                    detail: detail,
                    type:type
                }
                    data.push(obj); //存入变量
                }
                }
                }
            }
          })
          result['data'] = data
          console.log(JSON.stringify(result))//打印

          //var result1 = document.querySelector('#result1');
          //result1.innerHTML = XLSX.utils.sheet_to_html(sheet);
        };
        reader.readAsArrayBuffer(file);
      },
    },
  })
</script>